<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nexa Research Agent</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>

    <!-- Lucide icons -->
    <script type="module">
      import { createIcons, icons } from "https://cdn.jsdelivr.net/npm/lucide@0.341.0/+esm";
      window.addEventListener("DOMContentLoaded", () => createIcons({ icons }));
    </script>

    <!-- Tiny entrance animation -->
    <style>
      @keyframes pop {
        0% {
          opacity: 0;
          transform: scale(0.95);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }
      .pop-in {
        animation: pop 0.4s ease-out forwards;
      }
      /* Hide elements by default */
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body class="min-h-screen bg-zinc-900 text-zinc-100 flex items-center justify-center p-4 antialiased">
    <!-- Pricing & Landing Screen -->
    <div id="pricing-screen" class="w-full max-w-xl space-y-8 pop-in">
      <!-- Brand -->
      <div class="flex items-center justify-center gap-3 select-none">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
          <circle cx="8" cy="8" r="1.4" />
          <circle cx="16" cy="8" r="1.4" />
          <circle cx="8" cy="16" r="1.4" />
          <circle cx="16" cy="16" r="1.4" />
          <path d="M8 3v3m8-3v3m0 12v3m-8-3v3M3 8h3m0 8H3m18-8h-3m0 8h3" />
        </svg>
        <span class="text-2xl font-semibold tracking-tight">Nexa Research Agent</span>
      </div>

      <!-- Value Proposition -->
      <div class="text-center">
        <h1 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">Your Personal AI Research Assistant</h1>
        <p class="mt-4 text-lg leading-8 text-zinc-300">Get structured, source-backed reports on any topic in minutes. We provide the speed, convenience, and high-quality output—you bring your own API keys to control costs.</p>
      </div>

      <!-- Pricing Card -->
      <div class="bg-zinc-800/60 backdrop-blur rounded-2xl shadow-xl ring-1 ring-zinc-700/50 p-8">
        <h3 class="text-lg font-semibold leading-8 tracking-tight text-cyan-400">Pro Plan</h3>
        <p class="mt-4 text-sm leading-6 text-zinc-300">Full access to the research platform, priority processing, and premium models.</p>
        <p class="mt-6 flex items-baseline gap-x-1">
          <span class="text-4xl font-bold tracking-tight text-white">$15</span>
          <span class="text-sm font-semibold leading-6 text-zinc-300">/month</span>
        </p>
        <a href="https://buy.stripe.com/3cI7sM2xLcs2dCPgF7bjW02" id="subscribe-button" class="mt-6 block rounded-md bg-cyan-600 px-3 py-2 text-center text-sm font-semibold leading-6 text-white shadow-sm hover:bg-cyan-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600">Get 7-day free trial</a>
        <p class="mt-3 text-xs leading-5 text-zinc-400">You will be redirected to Stripe to complete your purchase.</p>
      </div>

      <!-- Access Key Entry -->
      <div class="pt-4">
        <label for="nexa_access_key" class="block text-sm font-medium leading-6 text-zinc-300">Already have a key?</label>
        <div class="mt-2 flex gap-x-2">
          <input type="password" id="nexa_access_key" class="block w-full rounded-md border-0 bg-white/5 py-1.5 px-3 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-cyan-500 sm:text-sm sm:leading-6" placeholder="Enter your Nexa Access Key" />
          <button id="unlock-button" type="button" class="rounded-md bg-zinc-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-zinc-500">Unlock</button>
        </div>
      </div>
    </div>

    <!-- Main Application Screen -->
    <div id="app-screen" class="w-full max-w-xl space-y-8 pop-in hidden">
      <!-- Brand bar -->
      <div class="flex items-center justify-between gap-3 select-none">
        <div class="flex items-center gap-3">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <circle cx="8" cy="8" r="1.4" />
            <circle cx="16" cy="8" r="1.4" />
            <circle cx="8" cy="16" r="1.4" />
            <circle cx="16" cy="16" r="1.4" />
            <path d="M8 3v3m8-3v3m0 12v3m-8-3v3M3 8h3m0 8H3m18-8h-3m0 8h3" />
          </svg>
          <span class="text-2xl font-semibold tracking-tight">Nexa Research Agent</span>
        </div>
        <button id="logout-button" class="text-sm text-zinc-400 hover:text-white">Logout</button>
      </div>

      <!-- Query bar -->
      <form id="research-form" class="flex flex-col gap-4 bg-zinc-800/60 backdrop-blur rounded-2xl shadow-xl ring-1 ring-zinc-700/50 px-5 py-4">
        <div class="flex flex-col sm:flex-row items-center gap-3 w-full">
          <label for="topic" class="sr-only">Research Topic</label>
          <input type="text" id="topic" name="topic" class="flex-1 bg-transparent border-0 focus:ring-0 placeholder-zinc-400 text-base w-full" placeholder="What do you want to explore?" required />

          <label for="model" class="sr-only">Model</label>
          <select id="model" name="model" class="rounded-lg bg-zinc-700/60 py-2 px-3 text-sm focus:ring-2 focus:ring-cyan-500">
            <option value="DeepSeek-R1-open">DeepSeek R1 (open)</option>
            <option value="Qwen-72B-instruct">Qwen 72B (instruct)</option>
            <option value="Qwen-14B-chat">Qwen 14B (chat)</option>
            <option value="Claude-3-Haiku">Claude 3 Haiku</option>
            <option value="Claude-3-Sonnet">Claude 3 Sonnet</option>
          </select>

          <button type="submit" class="inline-flex items-center gap-1 rounded-lg bg-cyan-600 px-4 py-2 text-sm font-medium hover:bg-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-500">
            <i data-lucide="arrow-up-right"></i>
            Run
          </button>
        </div>
        <!-- API Keys & Settings -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 border-t border-zinc-700/50 pt-4">
          <div>
            <label for="openrouter_key" class="sr-only">OpenRouter API Key</label>
            <input type="password" id="openrouter_key" class="w-full bg-transparent border-0 focus:ring-0 placeholder-zinc-500 text-sm" placeholder="Your OpenRouter API Key..." required />
          </div>
          <div>
            <label for="exa_key" class="sr-only">Exa API Key</label>
            <input type="password" id="exa_key" class="w-full bg-transparent border-0 focus:ring-0 placeholder-zinc-500 text-sm" placeholder="Your Exa API Key..." required />
          </div>
          <div class="col-span-full flex items-center gap-3">
            <label for="temperature" class="text-sm text-zinc-400">Temp:</label>
            <input type="range" id="temperature" name="temperature" min="0" max="1" step="0.1" value="0.7" class="w-full h-2 bg-zinc-700 rounded-lg appearance-none cursor-pointer" />
            <span id="temp-value" class="text-sm text-zinc-400 w-8 text-center">0.7</span>
          </div>
        </div>
      </form>

      <!-- Result panel -->
      <section id="result" class="space-y-4"></section>
    </div>

    <!-- JS -->
    <script>
      // --- DOM Elements ---
      const pricingScreen = document.getElementById("pricing-screen");
      const appScreen = document.getElementById("app-screen");
      const nexaAccessKeyInput = document.getElementById("nexa_access_key");
      const unlockButton = document.getElementById("unlock-button");
      const logoutButton = document.getElementById("logout-button");
      const subscribeButton = document.getElementById("subscribe-button");
      const form = document.getElementById("research-form");
      const result = document.getElementById("result");
      const openRouterKeyInput = document.getElementById("openrouter_key");
      const exaKeyInput = document.getElementById("exa_key");
      const temperatureSlider = document.getElementById("temperature");
      const tempValue = document.getElementById("temp-value");

      const NEXA_KEY_STORAGE = "nexa_access_key";
      const OPENROUTER_KEY_STORAGE = "openrouter_api_key";
      const EXA_KEY_STORAGE = "exa_api_key";

      // --- Functions ---
      function showApp() {
        pricingScreen.classList.add("hidden");
        appScreen.classList.remove("hidden");
        // Load saved keys into the form
        openRouterKeyInput.value = localStorage.getItem(OPENROUTER_KEY_STORAGE) || "";
        exaKeyInput.value = localStorage.getItem(EXA_KEY_STORAGE) || "";
      }

      function showPricing() {
        appScreen.classList.add("hidden");
        pricingScreen.classList.remove("hidden");
      }

      function logout() {
        localStorage.removeItem(NEXA_KEY_STORAGE);
        // Optional: clear other keys on logout
        // localStorage.removeItem(OPENROUTER_KEY_STORAGE);
        // localStorage.removeItem(EXA_KEY_STORAGE);
        showPricing();
      }

      async function runQuery() {
        const topic = document.getElementById("topic").value.trim();
        const model = document.getElementById("model").value;
        const nexaKey = localStorage.getItem(NEXA_KEY_STORAGE);
        const openRouterKey = openRouterKeyInput.value.trim();
        const exaKey = exaKeyInput.value.trim();
        const temperature = parseFloat(temperatureSlider.value);

        if (!topic || !nexaKey || !openRouterKey || !exaKey) {
          result.innerHTML = `<div class="text-yellow-400">Please provide a topic and all required API keys.</div>`;
          return;
        }

        // Save keys for convenience
        localStorage.setItem(OPENROUTER_KEY_STORAGE, openRouterKey);
        localStorage.setItem(EXA_KEY_STORAGE, exaKey);

        result.innerHTML = '<div class="text-sm text-zinc-400">Research in progress…</div>';

        // --- Mock API for GitHub Pages Demo ---
        // This simulates a backend call without needing a running server.
        setTimeout(() => {
          const dummy_report = {
            title: `Research Report on: ${topic}`,
            summary: `This is a synthesized summary based on multiple sources. The actual implementation would use Exa.ai and the ${model} model to generate this.`,
            sources: [
              "https://example.com/source1",
              "https://example.com/source2",
              "https://example.com/source3",
            ],
          };
          result.innerHTML = `<pre class="whitespace-pre-wrap bg-zinc-800/60 p-4 rounded-xl text-sm leading-6">${JSON.stringify(dummy_report, null, 2)}</pre>`;
        }, 1500);
        // --- End Mock API ---
      }

      // --- Event Listeners ---
      subscribeButton.addEventListener("click", (e) => {
        // The link will now navigate directly to Stripe.
        // No fetch call needed.
      });

      unlockButton.addEventListener("click", () => {
        const key = nexaAccessKeyInput.value.trim();
        if (key) {
          // In a real app, you'd validate this key against a server endpoint
          localStorage.setItem(NEXA_KEY_STORAGE, key);
          showApp();
        }
      });

      logoutButton.addEventListener("click", logout);

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        await runQuery();
      });

      temperatureSlider.addEventListener("input", (e) => {
        tempValue.textContent = parseFloat(e.target.value).toFixed(1);
      });

      // --- Initial Load ---
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        // Stripe can be configured to redirect to a success URL.
        // We check for a parameter on that URL.
        if (urlParams.has("session_id")) {
          // Simulate receiving a key after successful payment
          const fakeKey = "nexa-key-" + Math.random().toString(36).substring(2, 15);
          localStorage.setItem(NEXA_KEY_STORAGE, fakeKey);
          // Clean up the URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }

        const savedNexaKey = localStorage.getItem(NEXA_KEY_STORAGE);
        if (savedNexaKey) {
          showApp();
        } else {
          showPricing();
        }
      });
    </script>
  </body>
</html>
